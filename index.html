<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title data-i18n="title">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
body{background:linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%);min-height:100vh;padding:20px;display:flex;justify-content:center;align-items:flex-start}
.container{background:#fff;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,.15);padding:40px;max-width:1200px;width:100%;margin-top:20px}
.scale-wrap{transform-origin:top center}

.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:25px}
.header-left{display:flex;align-items:center;gap:15px}
.logo{height:48px}
.lang-switch span{cursor:pointer;font-weight:600;margin-left:12px;color:#667eea}
.lang-switch span.active{text-decoration:underline}
h1{font-size:32px;color:#2c3e50}

.calculator-section{display:flex;flex-wrap:wrap;gap:40px}
.input-section{flex:1;min-width:350px;padding:25px;background:#f8f9fa;border-radius:15px}
.output-section{flex:2;min-width:500px}

.input-group{margin-bottom:20px}
label{display:block;margin-bottom:8px;font-weight:600;font-size:14px;color:#495057}
.currency-input,.percentage-input{position:relative}
.currency-input input,.percentage-input input,input[type=number],select{
width:100%;padding:12px 15px;border:2px solid #e0e0e0;border-radius:8px;font-size:16px}
.currency-input input{padding-right:45px}
.percentage-input input{padding-right:45px}
.currency-symbol{position:absolute;left:15px;top:50%;transform:translateY(-50%);font-weight:bold}
.percentage-symbol{position:absolute;right:15px;top:50%;transform:translateY(-50%);font-weight:bold}

.calculate-btn,.client-btn,.pdf-btn{
width:100%;padding:16px;border:none;border-radius:10px;font-size:18px;font-weight:600;cursor:pointer;margin-bottom:10px}
.calculate-btn{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}
.client-btn{background:#2c3e50;color:#fff}
.pdf-btn{background:#444;color:#fff}

.summary-section{background:#fff;border-radius:15px;padding:25px;margin-bottom:30px}
.summary-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px}
.summary-item{text-align:center;padding:20px;background:#f8f9fa;border-radius:10px}
.summary-label{font-size:14px;color:#6c757d;margin-bottom:8px}
.summary-value{font-size:22px;font-weight:700;color:#2c3e50}
.summary-sub{font-size:13px;color:#6c757d;margin-top:4px}

.results-container{background:#fff;border-radius:15px;padding:25px}
.schedule-container{border:2px solid #e9ecef;border-radius:10px}
table{width:100%;border-collapse:collapse;font-size:14px}
thead{background:#2c3e50;color:#fff}
th,td{padding:10px;text-align:center}
tbody tr:nth-child(even){background:#fafafa}

.client .input-section,
.client .calculate-btn,
.client .client-btn,
.client .lang-switch{display:none}
.client .container{box-shadow:none}

@media print {

  @page {
    size: A4 portrait;
    margin: 4mm;
  }
  .header {
  margin-bottom: 10px !important;
}

.summary-section {
  margin-bottom: 12px !important;
  padding: 14px !important;
}

.results-container {
  padding: 12px !important;
}

  html, body {
    width: 210mm;
    height: 297mm;
    overflow: hidden;
  }

  body {
    background: #fff !important;
  }

  .container {
    box-shadow: none !important;
    margin: 0 !important;
    padding: 0 !important;
    width: 100% !important;
    max-width: none !important;
  }

  /* üîë –í–ê–ñ–ù–û: –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –í–°–Å */
  .scale-wrap {
    transform: scale(0.82);
    transform-origin: top center;
  }

  /* –∑–∞–ø—Ä–µ—â–∞–µ–º –ø–µ—Ä–µ–Ω–æ—Å —Ç–∞–±–ª–∏—Ü—ã */
  table, tr, td, th {
    page-break-inside: avoid !important;
  }

  .results-container,
  .summary-section {
    page-break-inside: avoid !important;
  }

  /* —Å–∫—Ä—ã–≤–∞–µ–º –≤–≤–æ–¥ */
  .input-section,
  .calculate-btn,
  .client-btn,
  .pdf-btn,
  .lang-switch {
    display: none !important;
  }

}



</style>
</head>

<body>
<div class="container">
<div class="scale-wrap">

<div class="header">
  <div class="header-left">
    <img src="logo.png" class="logo">
    <h1 data-i18n="title">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</h1>
  </div>
  <div class="lang-switch">
    <span data-lang="ru">RU</span>
    <span data-lang="uz">UZ</span>
    <span data-lang="en">ENG</span>
  </div>
</div>

<div class="calculator-section">

<div class="input-section">
<div class="input-group">
<label data-i18n="price">–°—Ç–æ–∏–º–æ—Å—Ç—å –æ–±—ä–µ–∫—Ç–∞</label>
<div class="currency-input">
<input type="text" id="price" value="000"></div>
</div>

<div class="input-group">
<label data-i18n="advance">–ê–≤–∞–Ω—Å (%)</label>
<div class="percentage-input">
<input type="text" id="advance" value="0"><span class="percentage-symbol">%</span>
</div>
</div>

<div class="input-group">
<label data-i18n="term">–°—Ä–æ–∫ (–º–µ—Å.)</label>
<input type="number" id="term" value="0">
</div>

<div class="input-group">
<label data-i18n="type">–¢–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞</label>
<select id="type">
<option value="annuity" data-i18n="t_annuity">–ê–Ω–Ω—É–∏—Ç–µ—Ç</option>
<option value="annuity_q" data-i18n="t_annuity_q">–ê–Ω–Ω—É–∏—Ç–µ—Ç (–∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–π)</option>
<option value="decl2" data-i18n="t_decl2">–£–±—ã–≤–∞—é—â–∏–π 2x</option>
<option value="decl3" data-i18n="t_decl3">–£–±—ã–≤–∞—é—â–∏–π 3x</option>
<option value="linear_q" data-i18n="t_linear">–õ–∏–Ω–µ–π–Ω—ã–π (–∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–π)</option>
<option value="inst_m" data-i18n="t_inst_m">–†–∞—Å—Å—Ä–æ—á–∫–∞ –µ–∂–µ–º–µ—Å—è—á–Ω–∞—è</option>
<option value="inst_q" data-i18n="t_inst_q">–†–∞—Å—Å—Ä–æ—á–∫–∞ –∫–≤–∞—Ä—Ç–∞–ª—å–Ω–∞—è</option>
</select>
</div>

<button class="calculate-btn" onclick="build()" data-i18n="calc">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
<button class="client-btn" onclick="toggleClient()" data-i18n="client">–†–µ–∂–∏–º –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞</button>
<button class="pdf-btn" onclick="window.print()" data-i18n="pdf">PDF / –ü–µ—á–∞—Ç—å</button>
</div>

<div class="output-section">
<div class="summary-section">
<div class="summary-grid">
<div class="summary-item"><div class="summary-label" data-i18n="lease">–î–æ–ª–≥ –ª–∏–∑–∏–Ω–≥–∞</div><div class="summary-value" id="outLease">0</div></div>
<div class="summary-item"><div class="summary-label" data-i18n="adv">–ê–≤–∞–Ω—Å</div><div class="summary-value" id="outAdvance">0</div></div>
<div class="summary-item"><div class="summary-label" data-i18n="over">–ü—Ä–æ—Ü–µ–Ω—Ç –ª–∏–∑–∏–Ω–≥–æ–≤–æ–π –∫–æ–º–ø–∞–Ω–∏–∏</div><div class="summary-value" id="outOver">0</div></div>
<div class="summary-item"><div class="summary-label" data-i18n="total">–û–±—â–∞—è —Å—É–º–º–∞ –æ–ø–ª–∞—Ç—ã</div><div class="summary-value" id="outTotal">0</div></div>
<div class="summary-item">
  <div class="summary-label" data-i18n="margin">–ï–¥–∏–Ω–æ—Ä–∞–∑–æ–≤–∞—è –º–∞—Ä–∂–∞</div>
  <div class="summary-value" id="outMargin">0</div>
  <div class="summary-sub" id="outMarginPct"></div>
</div>
<div class="summary-item">
  <div class="summary-label" data-i18n="ins">–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ</div>
  <div class="summary-value" id="outIns">0</div>
  <div class="summary-sub" id="outInsPct"></div>
</div>
</div>
</div>

<div class="results-container">
<div class="schedule-container">
<table>
<thead>
<tr>
<th data-i18n="m">–ú–µ—Å—è—Ü</th>
<th data-i18n="p">–û–±—â–∞—è —Å—É–º–º–∞ –æ–ø–ª–∞—Ç—ã</th>
<th data-i18n="pr">–û–ø–ª–∞—Ç–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –¥–æ–ª–≥–∞</th>
<th data-i18n="i">–ú–∞—Ä–∂–∞</th>
<th data-i18n="b">–û—Å—Ç–∞—Ç–æ–∫</th>
</tr>
</thead>
<tbody id="tbl"></tbody>
</table>
</div>
</div>
</div>
</div>
</div>


<script>
const REG=876736;
const RATE=0.2975/12;
const MARGIN_RATE=0.035;

const i18n={
ru:{title:"–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä",price:"–°—Ç–æ–∏–º–æ—Å—Ç—å –æ–±—ä–µ–∫—Ç–∞",advance:"–ê–≤–∞–Ω—Å (%)",term:"–°—Ä–æ–∫ (–º–µ—Å.)",
type:"–¢–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞",calc:"–†–∞—Å—Å—á–∏—Ç–∞—Ç—å",client:"–†–µ–∂–∏–º –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞",pdf:"PDF / –ü–µ—á–∞—Ç—å",
lease:"–î–æ–ª–≥ –ª–∏–∑–∏–Ω–≥–∞",adv:"–ê–≤–∞–Ω—Å",over:"–ü–µ—Ä–µ–ø–ª–∞—Ç–∞",total:"–û–±—â–∞—è —Å—É–º–º–∞ –æ–ø–ª–∞—Ç—ã",margin:"–ï–¥–∏–Ω–æ—Ä–∞–∑–æ–≤–∞—è –º–∞—Ä–∂–∞",ins:"–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ",
m:"–ú–µ—Å—è—Ü",p:"–û–±—â–∞—è —Å—É–º–º–∞ –æ–ø–ª–∞—Ç—ã",pr:"–û–ø–ª–∞—Ç–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –¥–æ–ª–≥–∞",i:"–ú–∞—Ä–∂–∞",b:"–û—Å—Ç–∞—Ç–æ–∫",
t_annuity:"–ê–Ω–Ω—É–∏—Ç–µ—Ç",t_annuity_q:"–ê–Ω–Ω—É–∏—Ç–µ—Ç (–∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–π)",t_decl2:"–£–±—ã–≤–∞—é—â–∏–π 2x",t_decl3:"–£–±—ã–≤–∞—é—â–∏–π 3x",
t_linear:"–õ–∏–Ω–µ–π–Ω—ã–π (–∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–π)",t_inst_m:"–†–∞—Å—Å—Ä–æ—á–∫–∞ –µ–∂–µ–º–µ—Å—è—á–Ω–∞—è",t_inst_q:"–†–∞—Å—Å—Ä–æ—á–∫–∞ –∫–≤–∞—Ä—Ç–∞–ª—å–Ω–∞—è"},
en:{title:"Calculator",price:"Asset price",advance:"Advance (%)",term:"Term (months)",
type:"Schedule type",calc:"Calculate",client:"Client mode",pdf:"PDF / Print",
lease:"Lease balance",adv:"Advance",over:"Overpayment",total:"Total payment",margin:"One-time commission",ins:"Insurance",
m:"Month",p:"Payment",pr:"Principal",i:"Margin",b:"Balance",
t_annuity:"Annuity",t_annuity_q:"Quarterly annuity",t_decl2:"Declining 2x",t_decl3:"Declining 3x",
t_linear:"Quarterly linear",t_inst_m:"Monthly installment",t_inst_q:"Quarterly installment"},
uz:{title:"Kalkulyator",price:"Mol-mulk qiymati",advance:"Boshlang‚Äòich to‚Äòlov (%)",term:"Muddati (oy)",
type:"To‚Äòlov jadvali",calc:"Hisoblash",client:"Mijoz rejimi",pdf:"PDF / Chop etish",
lease:"Lizing qoldig‚Äòi",adv:"Boshlang‚Äòich to‚Äòlov",over:"Ortiqcha to‚Äòlov",total:"Jami to‚Äòlov",margin:"Bir martalik marja",ins:"Sug‚Äòurta",
m:"Oy",p:"To‚Äòlov",pr:"Asosiy qarz",i:"Marja",b:"Qoldiq",
t_annuity:"Annuitet",t_annuity_q:"Annuitet (choraklik)",t_decl2:"Kamayuvchi 2x",t_decl3:"Kamayuvchi 3x",
t_linear:"Chiziqli (choraklik)",t_inst_m:"Oylik bo‚Äòlib to‚Äòlash",t_inst_q:"Choraklik bo‚Äòlib to‚Äòlash"}
};

function setLang(l){
document.querySelectorAll('[data-i18n]').forEach(e=>{
const k=e.dataset.i18n;
if(i18n[l][k])e.tagName==="OPTION"?e.innerHTML=i18n[l][k]:e.textContent=i18n[l][k];
});
document.querySelectorAll('.lang-switch span').forEach(s=>s.classList.toggle('active',s.dataset.lang===l));
localStorage.setItem('lang',l);
}
document.querySelectorAll('.lang-switch span').forEach(s=>s.onclick=()=>setLang(s.dataset.lang));
setLang(localStorage.getItem('lang')||'ru');

function insuranceRateSpecial(termMonths){
  const BASE_RATE = 0.0008;
  return termMonths * BASE_RATE / 12;
}

function n(v){return parseFloat(String(v).replace(/\s|\u00A0/g,'').replace(',','.'))||0}
function f(x){x=Math.round(x*100)/100;let p=x.toString().split('.');p[0]=p[0].replace(/\B(?=(\d{3})+(?!\d))/g,' ');return p.length===1?p[0]+'.00':p[1].length===1?p[0]+'.'+p[1]+'0':p.join('.')}

function annuity(a,r,t){
let bal=a,res=[],pay=a*(r*Math.pow(1+r,t))/(Math.pow(1+r,t)-1);
for(let i=1;i<=t;i++){
let intr=bal*r,pr=Math.min(bal,pay-intr);
bal-=pr;
res.push([i,pay,pr,intr,Math.max(0,bal)]);
}
return res;
}

function annuityQuarterly(a,r,t){
const base=annuity(a,r,t);
let res=[],bal=a,accPay=0,accPr=0;
for(let i=1;i<=t;i++){
const intr=bal*r;
accPay+=base[i-1][1];
accPr+=base[i-1][2];
if(i%3===0||i===t){
bal-=accPr;
res.push([i,accPay,accPr,intr,Math.max(0,bal)]);
accPay=0;accPr=0;
}else res.push([i,null,null,intr,bal]);
}
return res;
}

function declining(a,r,t,ratio){
let ann=a*(r*Math.pow(1+r,t))/(Math.pow(1+r,t)-1);
let first=ann*1.5,last=first/ratio,dec=t>1?(first-last)/(t-1):0,best=first,err=a;
for(let it=0;it<200;it++){
let bal=a,ok=true;
for(let i=1;i<=t;i++){
let cur=first-(i-1)*dec,intr=bal*r,pr=cur-intr;
if(pr<=0){ok=false;break}
bal-=pr;
}
if(ok){
if(Math.abs(bal)<Math.abs(err)){err=bal;best=first}
if(Math.abs(bal)<a*1e-6)break;
first*=bal>0?1.001:0.999;
}else first*=1.001;
last=first/ratio;
dec=t>1?(first-last)/(t-1):0;
}
first=best;last=first/ratio;dec=t>1?(first-last)/(t-1):0;
let res=[],bal=a;
for(let i=1;i<=t;i++){
let pay=first-(i-1)*dec,intr=bal*r,pr;
if(i===t){pr=bal;pay=pr+intr;bal=0}
else{pr=pay-intr;if(pr<0)pr=0;if(pr>bal)pr=bal;bal-=pr}
res.push([i,pay,pr,intr,Math.max(0,bal)]);
}
return res;
}

function linearQuarterly(a,r,t){
let res=[],bal=a,q=Math.floor((t+2)/3),prQ=a/q;
for(let i=1;i<=t;i++){
let intr=bal*r;
if(i%3===0||i===t){
let pr=i===t?bal:prQ;
let pay=pr+intr*3;
bal-=pr;
res.push([i,pay,pr,intr,Math.max(0,bal)]);
}else res.push([i,null,null,intr,bal]);
}
return res;
}

function installment(a,t,quarter){
let res=[],bal=a,per=a/t,acc=0;
for(let i=1;i<=t;i++){
let p=i===t?bal:per;bal-=p;
if(quarter){
acc+=p;
if(i%3===0||i===t){res.push([i,acc,acc,0,Math.max(0,bal)]);acc=0}
else res.push([i,null,null,null,null]);
}else res.push([i,p,p,0,Math.max(0,bal)]);
}
return res;
}


function build(){
let P=n(price.value),A=n(advance.value)/100,T=+term.value;
let total=P+REG;
let adv=total*A;
let lease=total-adv;
let margin=total*MARGIN_RATE;
let insRate = insuranceRateSpecial(T);
let insurance = lease * insRate;

let sch=[];
switch(type.value){
case"annuity":sch=annuity(lease,RATE,T);break;
case"annuity_q":sch=annuityQuarterly(lease,RATE,T);break;
case"decl2":sch=declining(lease,RATE,T,2);break;
case"decl3":sch=declining(lease,RATE,T,3);break;
case"linear_q":sch=linearQuarterly(lease,RATE,T);break;
case"inst_m":sch=installment(lease,T,false);break;
case"inst_q":sch=installment(lease,T,true);break;
}

let over=0;tbl.innerHTML="";
sch.forEach(r=>{
if(r[3])over+=r[3];
tbl.innerHTML+=`<tr>
<td>${r[0]}</td>
<td>${r[1]!=null?f(r[1]):'-'}</td>
<td>${r[2]!=null?f(r[2]):'-'}</td>
<td>${r[3]!=null?f(r[3]):'-'}</td>
<td>${r[4]!=null?f(r[4]):'-'}</td>
</tr>`;
});

outLease.textContent=f(lease);
outAdvance.textContent=f(adv);
outOver.textContent=f(over);
outTotal.textContent=f(lease+over);
outMargin.textContent=f(margin);
outMarginPct.textContent=(MARGIN_RATE*100).toFixed(2).replace('.',',')+'%';
outIns.textContent = f(insurance);
outInsPct.textContent = (insRate * 100).toFixed(2).replace('.', ',') + '%';

}

build();
function fitToOnePagePrint() {
  const wrap = document.querySelector('.scale-wrap');
  if (!wrap) return;

  wrap.style.transform = 'scale(1)';

  const pageHeightPx = 1122; // ~ A4 –ø—Ä–∏ 96dpi
  const rect = wrap.getBoundingClientRect();

  if (rect.height > pageHeightPx) {
    const scale = pageHeightPx / rect.height;
    wrap.style.transform = `scale(${scale})`;
  }
}

window.addEventListener('beforeprint', fitToOnePagePrint);
window.addEventListener('afterprint', () => {
  const wrap = document.querySelector('.scale-wrap');
  if (wrap) wrap.style.transform = 'scale(1)';
});

function toggleClient(){
document.documentElement.classList.toggle('client');
}
  
document.querySelectorAll('.currency-input input').forEach(i=>{
  i.addEventListener('input',()=>{
    const v = n(i.value);
    if(v || i.value === '0'){
      i.value = v.toLocaleString('ru-RU');
    }
  });
});
</script>
</body>
</html>
